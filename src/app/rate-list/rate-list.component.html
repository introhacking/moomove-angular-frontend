<div class="tabs cus_container">
  <div class="tab" [class.active]="selectedTab === 'MANUAL RATE'" (click)="selectTab('MANUAL RATE')">ENTER MANUAL RATE</div>
  <div class="tab" [class.active]="selectedTab === 'VIEW MANUAL RATE'" (click)="selectTab('VIEW MANUAL RATE')">VIEW MANUAL RATE</div>
  <div class="tab" [class.active]="selectedTab === 'BULK'" (click)="selectTab('BULK')">BULK UPLOAD FILE</div>
</div>
<div class="cs-tabs-wrapper">
  <div style="position: relative; height: 100%;">
    <!-- <div class="overlay"></div> -->
    <div class="tabCaseUI">
      <div class="tab-content">
        <div *ngIf="selectedTab === 'MANUAL RATE'">
          <div class="container">
            <div class="row">
              <!-- FORM START -->
              <div class="col-12 border layout-wrapper">
                <div class="custom-scroll cs-hidden-scroll">
                  <form [formGroup]="formData" class="" action="POST" enctype="multipart/form-data">
                    <div class="cs-padding">
                      <!-- SELECT CARRIER -->
                      <div class="d-flex justify-content-between gap-2 mb-2">
                        <div class="col-12 col-md-6 mb-2 mb-md-4 form-floating" style="position: relative;">
                          <input [ngClass]="{'custom-invalid-border':formData.get('companyName')!.invalid && 
                          (formData.get('companyName')!.dirty || formData.get('companyName')!.touched)}" type="text"
                            formControlName="companyName" class="form-control" placeholder="Company name"
                            aria-label="Company name" (input)="onInput($event)" (focus)="showDropdown = true"
                            (blur)="hideDropdown()" (click)="showDropdown = true" />
                          <label [ngClass]="{'custom-invalid-text-color':formData.get('companyName')!.invalid && 
                          (formData.get('companyName')!.dirty || formData.get('companyName')!.touched)}"
                            for="floatingTextarea2">--Select Carrier--</label>
                          <!-- Dropdown for showing filtered companies -->
                          <div *ngIf="showDropdown && filteredCompanies.length > 0" class="dropdown-menu show"
                            (mousedown)="$event.preventDefault()"
                            style="position: absolute; top: 100%; left: 0; width: 100%; z-index: 1000;">
                            <button type="button" class="dropdown-item" *ngFor="let company of filteredCompanies"
                              (click)="selectCompany(company.name)">
                              {{ company.name }}
                            </button>
                          </div>
                          <!-- 'Not found' message only after 2 characters are entered -->
                          <div *ngIf="filteredCompanies.length === 0 && showDropdown && inputValue.length >= 2"
                            class="dropdown-menu show">
                            <button type="button" class="dropdown-item" disabled>Not found</button>
                          </div>
                          <!-- Error message for invalid input -->
                          <div style="position: absolute;"
                            *ngIf="formData.get('companyName')!.invalid && 
                                           (formData.get('companyName')!.dirty || formData.get('companyName')!.touched)">
                            <small class="text-danger">Carrier is required</small>
                          </div>
                          <!-- Server response message -->
                          <small class="text-danger" *ngIf="serverResposeMessage !== ''">{{
                            serverResposeMessage}}</small>
                        </div>
                      </div>
                      <!-- SOURCE & DESTINATION -->
                      <div class="d-flex justify-content-between gap-2 mb-2">
                        <!-- SOURCE -->
                        <div class="col-12 col-md-6 mb-2 mb-md-4 form-floating" style="position: relative;">
                          <input [ngClass]="{'custom-invalid-border':formData.get('source')!.invalid && 
                          (formData.get('source')!.dirty || formData.get('source')!.touched)}" type="text"
                            formControlName="source" class="form-control" placeholder="Source name"
                            aria-label="Source name" (input)="onSourceInput($event)" (focus)="showSourceDropdown = true"
                            (blur)="hideSourceDropdown()" (click)="showSourceDropdown = true" />
                          <label [ngClass]="{'custom-invalid-text-color':formData.get('source')!.invalid && 
                          (formData.get('source')!.dirty || formData.get('source')!.touched)}"
                            for="floatingTextarea2">--Select Origin Port--</label>

                          <div *ngIf="showSourceDropdown && filteredSources.length > 0" class="dropdown-menu show"
                            (mousedown)="$event.preventDefault()"
                            style="position: absolute; top: 100%; left: 0; width: 100%; z-index: 1000;">
                            <button type="button" class="dropdown-item" *ngFor="let source of filteredSources"
                              (click)="selectSource(source.name)">
                              {{ source.name }}
                            </button>
                          </div>

                          <div
                            *ngIf="filteredSources.length === 0 && showSourceDropdown && sourceInputValue.length >= 2"
                            class="dropdown-menu show">
                            <button type="button" class="dropdown-item" disabled>Not found</button>
                          </div>

                          <div style="position: absolute;" *ngIf="formData.get('source')!.invalid && 
                                               (formData.get('source')!.dirty || formData.get('source')!.touched)">
                            <small class="text-danger">Origin port is required</small>
                          </div>
                        </div>
                        <!-- DESTINATION -->
                        <div class="col-12 col-md-6 mb-2 mb-md-4 form-floating" style="position: relative;">
                          <input [ngClass]="{'custom-invalid-border':formData.get('destination')!.invalid && 
                          (formData.get('destination')!.dirty || formData.get('destination')!.touched)}" type="text"
                            formControlName="destination" class="form-control" placeholder="Destination name"
                            aria-label="Destination name" (input)="onDestinationInput($event)"
                            (focus)="showDestinationDropdown = true" (blur)="hideDestinationDropdown()"
                            (click)="showDestinationDropdown = true">
                          <label [ngClass]="{'custom-invalid-text-color':formData.get('destination')!.invalid && 
                          (formData.get('destination')!.dirty || formData.get('destination')!.touched)}"
                            for="floatingTextarea2">--Select Destination--</label>

                          <div *ngIf="showDestinationDropdown && filteredDestination.length > 0"
                            class="dropdown-menu show" (mousedown)="$event.preventDefault()"
                            style="position: absolute; top: 100%; left: 0; width: 100%; z-index: 1000;">
                            <button type="button" class="dropdown-item" *ngFor="let destination of filteredDestination"
                              (click)="selectDestination(destination.name)">
                              {{ destination.name }}
                            </button>
                          </div>

                          <div
                            *ngIf="filteredDestination.length === 0 && showDestinationDropdown && destinationInputValue.length >= 2"
                            class="dropdown-menu show">
                            <button type="button" class="dropdown-item" disabled>Not found</button>
                          </div>

                          <div style="position: absolute;"
                            *ngIf="formData.get('destination')!.invalid && 
                                               (formData.get('destination')!.dirty || formData.get('destination')!.touched)">
                            <small class="text-danger">Destination is required</small>
                          </div>
                        </div>
                      </div>
                      <!-- FIELD RATE OR DIRECT SHIPMENT -->
                      <div class="d-flex justify-content-between gap-2 mb-2">
                        <div class="d-flex flex-column col-12 col-md-6 mb-2">
                          <div
                            class="form-check form-switch d-flex flex-column justify-content-between col-5 gap-3 mb-4">
                            <div class="d-inline">
                              <label class="form-check-label" for="flexSwitchCheckDefaultRate">{{isRateTypeStatus?'Spot'
                                : 'Filed'}}
                                Rate</label>
                            </div>
                            <input class="form-check-input" formControlName="isRateTypeStatus" type="checkbox"
                              role="switch" id="flexSwitchCheckDefaultRate" [checked]="isRateTypeStatus"
                              (change)="onRateCheckboxStatusChange($event)">
                          </div>
                          <div class="d-flex align-items-center justify-content-between gap-2 col-12 mb-2">
                            <div class="col-6 form-floating" style="position: relative;">
                              <input [ngClass]="{'custom-invalid-border':formData.get('vessel_name')!.invalid && 
                              (formData.get('vessel_name')!.dirty || formData.get('vessel_name')!.touched)}"
                                type="text" formControlName="vessel_name" class="form-control" placeholder="Vessel name"
                                aria-label="vessel_name">
                              <label [ngClass]="{'custom-invalid-text-color':formData.get('vessel_name')!.invalid && 
                              (formData.get('vessel_name')!.dirty || formData.get('vessel_name')!.touched)}"
                                for="floatingTextarea2">Vessel name</label>
                              <div style="position: absolute;"
                                *ngIf="formData.get('vessel_name')!.invalid && (formData.get('vessel_name')!.dirty || formData.get('vessel_name')!.touched)">
                                <small class="text-danger">Vessel name is required</small>
                              </div>
                            </div>

                            <div class="col-5 form-floating position-relative">
                              <input [ngClass]="{'custom-invalid-border':formData.get('voyage')!.invalid && 
                              (formData.get('voyage')!.dirty || formData.get('voyage')!.touched)}" type="text"
                                formControlName="voyage" class="form-control" placeholder="Voyage" aria-label="voyage">
                              <label [ngClass]="{'custom-invalid-text-color':formData.get('voyage')!.invalid && 
                              (formData.get('voyage')!.dirty || formData.get('voyage')!.touched)}"
                                for="floatingTextarea2">Voyage</label>
                              <div class="position-absolute"
                                *ngIf="formData.get('voyage')!.invalid && (formData.get('voyage')!.dirty || formData.get('voyage')!.touched)">
                                <small class="text-danger" *ngIf="formData.get('voyage')?.errors?.['pattern']">Voyage
                                  is invalid</small>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="d-flex flex-column col-12 col-md-6 mb-2">
                          <div
                            class="form-check form-switch d-flex flex-column justify-content-between col-5 gap-3 mb-4">
                            <div class="d-inline">
                              <label class="form-check-label" for="flexSwitchCheckDefault">Direct Shipment?</label>
                            </div>
                            <input class="form-check-input" type="checkbox" formControlName="isDirectShipment"
                              [checked]="isDirectShipment" role="switch" id="flexSwitchCheckDefault"
                              (change)="onDirectShipmentChange($event)">
                          </div>

                          <div class="col-12 form-floating position-relative">
                            <!-- Input field for typing and showing dropdown suggestions -->
                            <input
                              [ngClass]="{'custom-invalid-border':formData.get('transhipment_add_port')!.invalid && 
                            (formData.get('transhipment_add_port')!.dirty || formData.get('transhipment_add_port')!.touched)}"
                              type="text" class="form-control" placeholder="Via" formControlName="transhipment_add_port"
                              [value]="viaInputValue" (input)="onViaInput($event)" (focus)="showViaDropdown = true"
                              (blur)="hideViaDropdown()" />

                            <i *ngIf="filteredVia.length === 0 && showViaDropdown && viaInputValue.length >= 1"
                              class="fa fa-plus cs-addVia" (click)="addNewVia(viaInputValue)" height="22px" width="22px"
                              aria-hidden="true"></i>

                            <label
                              [ngClass]="{'custom-invalid-text-color':formData.get('transhipment_add_port')!.invalid && 
                            (formData.get('transhipment_add_port')!.dirty || formData.get('transhipment_add_port')!.touched)}"
                              for="floatingTextarea2">--Select Via--</label>

                            <!-- Display selected items with remove option -->
                            <div *ngIf="selectedVia.length > 0" class="selected-via-list mt-2">
                              <span *ngFor="let via of selectedVia" class="badge bg-primary me-1">
                                {{ via }}
                                <button type="button" class="btn-close btn-close-white ms-1" aria-label="Close"
                                  (click)="removeVia(via)"></button>
                              </span>
                            </div>

                            <!-- Dropdown menu for suggestions -->
                            <div *ngIf="showViaDropdown && filteredVia.length > 0" class="dropdown-menu show w-100"
                              style="position: absolute; top: 100%; left: 0; z-index: 1000;">
                              <ul class="list-group list-group-flush">
                                <li *ngFor="let viaName of filteredVia" class="list-group-item list-group-item-action"
                                  [class.active]="isSelected(viaName.name)" (mousedown)="selectVia(viaName.name)">
                                  {{ viaName.name }}
                                </li>
                              </ul>
                            </div>

                            <!-- "Not found" message when no matching options are available -->
                            <div *ngIf="filteredVia.length === 0 && showViaDropdown && viaInputValue.length >= 1"
                              class="dropdown-menu show w-100"
                              style="position: absolute; top: 100%; left: 0; z-index: 1000;">
                              <button type="button" class="dropdown-item" disabled>Not found</button>
                            </div>

                            <!-- Validation message -->
                            <div style="position: absolute;"
                              *ngIf="formData.get('transhipment_add_port')!.invalid && (formData.get('transhipment_add_port')!.dirty || formData.get('transhipment_add_port')!.touched)">
                              <small class="text-danger">Via is required</small>
                            </div>
                          </div>
                        </div>

                      </div>

                      <!-- HAZARDOUS / NON-HAZARDOUS -->
                      <div class="d-flex justify-content-between flex-column gap-2 mb-2">
                        <div class="form-check form-switch d-flex flex-column justify-content-between col-5 gap-3 mb-4">
                          <div class="d-inline">
                            <label class="form-check-label"
                              for="flexSwitchCheckDefaultHaz">{{hazActiveStatus?'Hazardous':'Non-Hazardous'}}</label>
                          </div>
                          <input class="form-check-input" formControlName="hazActiveStatus" [checked]="hazActiveStatus"
                            type="checkbox" role="switch" id="flexSwitchCheckDefaultHaz"
                            (change)="onHazCheckboxStatusChange($event)">
                        </div>

                        <div class="col-12 d-flex justify-content-between align-items-center gap-2 mb-4">
                          <div class="col-6 d-flex justify-content-between align-items-center gap-3">
                            <div class="col-5 form-floating position-relative">
                              <input [ngClass]="{'custom-invalid-border':formData.get('cargotype')!.invalid && 
                              (formData.get('cargotype')!.dirty || formData.get('cargotype')!.touched)}" type="text"
                                [disabled]="formData.get('hazActiveStatus')?.value" formControlName="cargotype"
                                class="form-control" placeholder="Commodity" aria-label="Commodity">
                              <label [ngClass]="{'custom-invalid-text-color':formData.get('cargotype')!.invalid && 
                              (formData.get('cargotype')!.dirty || formData.get('cargotype')!.touched)}"
                                for="floatingTextarea2">Commodity</label>
                              <div style="position: absolute;"
                                *ngIf="formData.get('cargotype')!.invalid && (formData.get('cargotype')!.dirty || formData.get('cargotype')!.touched)">
                                <small class="text-danger">Commodity is required</small>
                              </div>
                            </div>

                            <div class="input-group d-flex justify-content-end flex-nowrap form-floating">
                              <span class="input-group-text" id="addon-wrapping">UN</span>
                              <!-- <input type="number" formControlName="hazValue" class="form-control" placeholder="Haz" aria-label="Haz" aria-describedby="addon-wrapping"  id="hazValueInput"> -->
                              <div class="form-floating col-9">
                                <input [ngClass]="{'custom-invalid-border':formData.get('hazValue')!.invalid && 
                                (formData.get('hazValue')!.dirty || formData.get('hazValue')!.touched)}" type="text"
                                  formControlName="hazValue" class="form-control" placeholder="Haz" aria-label="Haz"
                                  id="hazValueInput">
                                <label [ngClass]="{'custom-invalid-text-color':formData.get('hazValue')!.invalid && 
                                (formData.get('hazValue')!.dirty || formData.get('hazValue')!.touched)}"
                                  for="hazValueInput" class="cs-container-label">{{hazActiveStatus?'Enter valid
                                  4-digit UN number':'Haz'}}</label>
                                <div style="position: absolute;"
                                  *ngIf="formData.get('hazValue')!.invalid && (formData.get('hazValue')!.dirty || formData.get('hazValue')!.touched)">
                                  <small class="text-danger" *ngIf="formData.get('hazValue')?.errors?.['required']">Haz
                                    value is required.</small>
                                  <small class="text-danger" *ngIf="formData.get('hazValue')?.errors?.['pattern']">Must
                                    be a
                                    4-digit number.</small>
                                </div>
                              </div>
                            </div>
                          </div>
                          <div class="col-6 d-flex justify-content-between align-items-center gap-3">
                            <div class="col-6 form-floating">
                              <input [ngClass]="{'custom-invalid-border':formData.get('haz_class')!.invalid && 
                              (formData.get('haz_class')!.dirty || formData.get('haz_class')!.touched)}" type="number"
                                formControlName="haz_class" class="form-control" placeholder="Haz class"
                                aria-label="haz_class" (input)="onHazClassInput($event)"
                                (focus)="showHazClassDropdown = true" (blur)="hideHazClassDropdown()">
                              <label [ngClass]="{'custom-invalid-text-color':formData.get('haz_class')!.invalid && 
                              (formData.get('haz_class')!.dirty || formData.get('haz_class')!.touched)}"
                                for="floatingTextarea2">--Select Haz Class--</label>

                              <!-- Dropdown menu that appears under the input -->
                              <div *ngIf="showHazClassDropdown && filteredHazClass.length > 0"
                                class="dropdown-menu show"
                                style="position: absolute; top: 80%; left: 0; width: 100%; z-index: 1000;">

                                <ul class="list-group">
                                  <li *ngFor="let hazValue of filteredHazClass" class="list-group-item"
                                    (mousedown)="selectHazClass(hazValue.hazClass)">
                                    {{ hazValue.hazClass }}
                                  </li>
                                </ul>
                              </div>

                              <!-- "Not found" message when no currencies match the input -->
                              <div
                                *ngIf="filteredHazClass.length === 0 && showHazClassDropdown && hazClassInputValue.length >= 1"
                                class="dropdown-menu show"
                                style="position: absolute; top: 80%; left: 0; width: 100%; z-index: 1000;">
                                <button type="button" class="dropdown-item" disabled>Not found</button>
                              </div>
                              <!-- Validation message -->
                              <div style="position: absolute;"
                                *ngIf="formData.get('haz_class')!.invalid && (formData.get('haz_class')!.dirty || formData.get('haz_class')!.touched)">
                                <small class="text-danger">Haz Class is required</small>
                              </div>
                            </div>

                            <div class="col-5 form-floating">
                              <select [ngClass]="{'custom-invalid-border':formData.get('packing_group')!.invalid && 
                              (formData.get('packing_group')!.dirty || formData.get('packing_group')!.touched)}"
                                formControlName="packing_group" id="floatingInput" class="form-control border">
                                <!-- <option value="" selected disabled>--Select Packing Group--</option> -->
                                <option [value]="pckgp.pckgp" *ngFor="let pckgp of packingGp">pckgp-{{pckgp.pckgp}}
                                </option>
                              </select>
                              <label [ngClass]="{'custom-invalid-text-color':formData.get('packing_group')!.invalid && 
                              (formData.get('packing_group')!.dirty || formData.get('packing_group')!.touched)}"
                                for="floatingTextarea2">--Select Packing Group--</label>
                              <!-- Validation message -->
                              <div style="position: absolute;"
                                *ngIf="formData.get('packing_group')!.invalid && (formData.get('packing_group')!.dirty || formData.get('packing_group')!.touched)">
                                <small class="text-danger">Packing group is required</small>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>


                      <div class="d-flex justify-content-between gap-2 mb-2">
                        <div class="col-12 col-md-6 mb-2 mb-md-4 form-floating position-relative">
                          <input [ngClass]="{'custom-invalid-border':formData.get('effectiveDate')!.invalid && 
                          (formData.get('effectiveDate')!.dirty || formData.get('effectiveDate')!.touched)}"
                            type="date" min={{todayDate}} formControlName="effectiveDate" class="form-control"
                            placeholder="Valid From" aria-label="Valid From" (change)="onValidFromChange()">
                          <label [ngClass]="{'custom-invalid-text-color':formData.get('effectiveDate')!.invalid && 
                          (formData.get('effectiveDate')!.dirty || formData.get('effectiveDate')!.touched)}"
                            for="floatingTextarea2">Valid From</label>
                          <div class="position-absolute"
                            *ngIf="formData.get('effectiveDate')!.invalid && (formData.get('effectiveDate')!.dirty || formData.get('effectiveDate')!.touched)">
                            <small class="text-danger">Valid From is required</small>
                          </div>
                        </div>
                        <div class="col-12 col-md-6 mb-2 mb-md-4 form-floating position-relative">
                          <input [ngClass]="{'custom-invalid-border':formData.get('expirationDate')!.invalid && 
                          (formData.get('expirationDate')!.dirty || formData.get('expirationDate')!.touched)}"
                            type="date" [min]="minExpirationDate" formControlName="expirationDate" class="form-control"
                            placeholder="Expiration date" aria-label="Expiration date"
                            (change)="onExpirationDateChange()">
                          <label [ngClass]="{'custom-invalid-text-color':formData.get('expirationDate')!.invalid && 
                          (formData.get('expirationDate')!.dirty || formData.get('expirationDate')!.touched)}"
                            for="floatingTextarea2">Expiration Date</label>
                          <div class="position-absolute"
                            *ngIf="formData.get('expirationDate')!.invalid && (formData.get('expirationDate')!.dirty || formData.get('expirationDate')!.touched)">
                            <small class="text-danger">Expiration date is required</small>
                          </div>
                        </div>
                      </div>

                      <div class="d-flex justify-content-between gap-2 mb-2">
                        <!-- <div class="col-6 d-flex justify-content-between gap-1"> -->
                        <div class="col-12 col-md-6 mb-2 mb-md-4 form-floating position-relative">
                          <input [ngClass]="{'custom-invalid-border':formData.get('rate')!.invalid && 
                          (formData.get('rate')!.dirty || formData.get('rate')!.touched)}" type="text" min="0"
                            formControlName="rate" class="form-control"
                            placeholder="Basic Ocean Freight (USD) based on equipment type (Yes, 20'/40'/40HQ)"
                            aria-label="Rate">
                          <label [ngClass]="{'custom-invalid-text-color':formData.get('rate')!.invalid && 
                          (formData.get('rate')!.dirty || formData.get('rate')!.touched)}"
                            for="floatingTextarea2">Rate</label>
                          <div class="position-absolute"
                            *ngIf="formData.get('rate')!.invalid && (formData.get('rate')!.dirty || formData.get('rate')!.touched)">
                            <small class="text-danger">Rate is required</small>
                          </div>
                        </div>
                        <!-- </div> -->

                        <div class="col-12 col-md-6 mb-2 mb-md-4 form-floating position-relative">
                          <!-- Input field for currency selection -->
                          <input [ngClass]="{'custom-invalid-border':formData.get('currency')!.invalid && 
                          (formData.get('currency')!.dirty || formData.get('currency')!.touched)}" type="text"
                            class="form-control" placeholder="Currency" formControlName="currency"
                            (input)="onCurrencyInput($event)" (focus)="showCurrencyDropdown = true"
                            (blur)="hideCurrencyDropdown()" />

                          <label [ngClass]="{'custom-invalid-text-color':formData.get('currency')!.invalid && 
                          (formData.get('currency')!.dirty || formData.get('currency')!.touched)}"
                            for="floatingTextarea2">--Select Currency--</label>

                          <!-- Dropdown menu that appears under the input -->
                          <div *ngIf="showCurrencyDropdown && filteredCurrencies.length > 0" class="dropdown-menu show"
                            style="position: absolute; top: 80%; left: 0; width: 100%; z-index: 1000;">

                            <ul class="list-group">
                              <li *ngFor="let currency of filteredCurrencies" class="list-group-item"
                                (mousedown)="selectCurrency(currency.code)">
                                {{ currency.code }} - {{ currency.name }}
                              </li>
                            </ul>
                          </div>

                          <!-- "Not found" message when no currencies match the input -->
                          <div
                            *ngIf="filteredCurrencies.length === 0 && showCurrencyDropdown && currencyInputValue.length >= 1"
                            class="dropdown-menu show"
                            style="position: absolute; top: 80%; left: 0; width: 100%; z-index: 1000;">
                            <button type="button" class="dropdown-item" disabled>Not found</button>
                          </div>

                          <!-- Validation message -->
                          <div class="position-absolute"
                            *ngIf="formData.get('currency')!.invalid && (formData.get('currency')!.dirty || formData.get('currency')!.touched)">
                            <small class="text-danger">Currency is required</small>
                          </div>
                        </div>
                      </div>

                      <div class="d-flex justify-content-between align-items-end gap-2 mb-2">
                        <div class="d-flex align-items-center justify-content-between col-12 gap-2 col-md-6">
                          <div class="col-12 col-md-6 mb-2 mb-md-4 form-floating position-relative">
                            <select [ngClass]="{'custom-invalid-border':formData.get('freightType')!.invalid && 
                            (formData.get('freightType')!.dirty || formData.get('freightType')!.touched)}"
                              class="form-select" formControlName="freightType" placeholder="Equipment type"
                              aria-label="Default select example">
                              <option selected disabled>--Select Equipment types--</option>
                              <option [value]="data.type" *ngFor="let data of equipmentsList">{{data.type}}</option>
                            </select>
                            <label [ngClass]="{'custom-invalid-text-color':formData.get('freightType')!.invalid && 
                            (formData.get('freightType')!.dirty || formData.get('freightType')!.touched)}"
                              for="floatingTextarea2">Equipment Type</label>

                            <div class="position-absolute"
                              *ngIf="formData.get('freightType')!.invalid && (formData.get('freightType')!.dirty || formData.get('freightType')!.touched)">
                              <small class="text-danger">Equipment type is required</small>
                            </div>
                          </div>
                          <div class="col-12 col-md-5 mb-2 mb-md-4 form-floating position-relative">
                            <input [ngClass]="{'custom-invalid-border':formData.get('transitTime')!.invalid && 
                            (formData.get('transitTime')!.dirty || formData.get('transitTime')!.touched)}"
                              type="number" min="0" formControlName="transitTime" class="form-control"
                              placeholder="Transit Days" aria-label="Transit time">
                            <label [ngClass]="{'custom-invalid-text-color':formData.get('transitTime')!.invalid && 
                            (formData.get('transitTime')!.dirty || formData.get('transitTime')!.touched)}"
                              for="floatingTextarea2">Transit Days</label>
                            <div class="position-absolute"
                              *ngIf="formData.get('transitTime')!.invalid && (formData.get('transitTime')!.dirty || formData.get('transitTime')!.touched)">
                              <small class="text-danger">Transit Days is required</small>
                            </div>
                          </div>
                        </div>

                        <div class="d-flex justify-content-between align-items-end col-12 col-md-6 gap-2">
                          <div class="col-12 col-md-4 mb-2 mb-md-4 form-floating position-relative">
                            <input [ngClass]="{'custom-invalid-border':formData.get('free_days')!.invalid && 
                            (formData.get('free_days')!.dirty || formData.get('free_days')!.touched)}" type="number"
                              min="1" formControlName="free_days" class="form-control" placeholder="Free Days"
                              aria-label="Free Days">
                            <label [ngClass]="{'custom-invalid-text-color':formData.get('free_days')!.invalid && 
                            (formData.get('free_days')!.dirty || formData.get('free_days')!.touched)}"
                              for="floatingTextarea2">Free Days</label>
                            <div class="position-absolute"
                              *ngIf="formData.get('free_days')!.invalid && (formData.get('free_days')!.dirty || formData.get('free_days')!.touched)">
                              <small class="text-danger">Free Days is required</small>
                            </div>
                          </div>
                          <div class="col-12 col-md-7 mb-2 mb-md-4 position-relative">
                            <!-- formControlName="free_days_comments" -->
                            <textarea class="form-control gap-2" formControlName='free_days_comment'
                              placeholder="Additional Comment" style="height: 80px"></textarea>
                          </div>
                        </div>
                      </div>
                      
                    </div>
                    <div class="col-12 mb-md-4">
                      <textarea class="form-control gap-2 mb-3" formControlName="remarks"
                        placeholder="Enter Remarks and Inclusions (Optional)" style="height: 100px"></textarea>
                    </div>
                    <div class="col-12">
                      <textarea class="form-control gap-2 mb-3" formControlName="terms_condition"
                        placeholder="Enter Terms and Conditions" style="height: 100px"></textarea>
                    </div>

                  </form>
                </div>
                <!-- <div class="modal-button-wrapper">
                  <button (click)="onSubmitHandler()" class="cms_button" [ngClass]="{ 'disabled': formData.invalid }"
                    [disabled]="formData.invalid">Submit</button>
                </div> -->
                <div class="modal-button-wrapper">
                  <button (click)="onSubmitHandler()" class="cms_button">Submit</button>
                </div>
              </div>
              <!-- END -->
            </div>
          </div>
        </div>
        <div *ngIf="selectedTab === 'VIEW MANUAL RATE'">
          <!-- Content for Page 2 -->
          <div class="col-sm-12">
            <div class="row" style="background-color: rgba(245, 248, 248, 0.904);">
              <div class="cms_moo_wrapper">
                <div class="col-sm-3 my-3 mx-2 cms_rate_inside">
                  <select id="companySelect" class="form-select dropdown-box my-0" (change)="ManualViewListDataById($event)">
                    <option selected disabled>--Select Shipping Line--</option>
                    <option *ngFor="let data of companyList" [value]="data.id">{{data.name | uppercase}}</option>
                  </select>
                </div>
              </div>
              <div class="col-sm-12 px-2">
                <span class="spinnerMain" *ngIf="snipperDialoug">
                  <div class="icon">
                    <div class="bar" style="background-color: #3498db; margin-left: -60px;"></div>
                    <div class="bar" style="background-color: #e74c3c; margin-left: -20px;"></div>
                    <div class="bar" style="background-color: #f1c40f; margin-left: 20px;"></div>
                    <div class="bar" style="background-color: #2eB869; margin-left: 60px;"></div>
                  </div>
                </span>
                <span class="spinnerMain" *ngIf="manualFilterChooseFromShippingLine ===''">
                  <div class="shipping-line">
                    <h2 class="my-5" style="color: rgba(97, 99, 100, 0.767);">Please Select Shipping Line</h2>
                  </div>
                </span>

                <!-- Loading message -->
                <div class="col-sm-12 d-flex justify-content-center align-items-center" style="text-align: left;" *ngIf="isLoading">
                  <div class="d-flex gap-3 align-items-center">
                    <div class="loader"></div><span><small> Finding...</small></span>
                  </div>
                </div>

                <!-- MANUAL RATE -->
                <div *ngIf="manualFilterChooseFromShippingLine !== '' && !isLoading">
                  <h5 class="mx-3 mt-4 tableNameLabel">Manual Rate List</h5>
                  <div class="cs-table-wrapper-manaual cs-hidden-scroll">
                    <table style="width:100%" class="table table-hover table-bordered">
                      <thead class="position-sticky top-0 start-0">
                        <tr class="table-primary">
                          <th>Shipping line</th>
                          <th>Source</th>
                          <th>Destination</th>
                          <th>Transit Time</th>
                          <th>Freight Type</th>
                          <th>Rate</th>
                          <th>Effective Date</th>
                          <th>Expiration Date</th>
                          <th>Action</th>
                        </tr>
                      </thead>
                      <tbody>
                        <!-- Iterate over the filtered data-->
                        <tr *ngFor="let currentData of (manualRateLists | searchFilter : searchText)">
                          <td>{{currentData.company.name}}</td>
                          <td>{{currentData.source.name}}</td>
                          <td>{{currentData.destination.name}}</td>
                          <td>{{currentData.transit_time.time}}</td>
                          <td>{{currentData.freight_type.type}}</td>
                          <td>{{currentData.rate}}</td>
                          <td>{{currentData.effective_date}}</td>
                          <td [ngStyle]="{'color': currentDate > currentData.expiration_date ? 'red' : 'blue'}">
                            {{currentData.expiration_date}}
                          </td>
                          <td class="cms_manual_action">
                            <tr class="cms_manual_edit" 
                              [ngStyle]="{
                                'visibility': currentDate > currentData.expiration_date ? 'hidden' : 'visible', 
                                'opacity': currentData.isRateUsed ? 0.5 : 1,
                                'cursor': currentData.isRateUsed ? 'default' : 'pointer'
                              }" 
                              [title]="currentData.isRateUsed ? 'This rate cannot be edited since it has been used in generating quotation.' : 'Edit'"
                              (click)="!currentData.isRateUsed && openManualEditModal(currentData)">
                              <!-- (click)="openManualEditModal(currentData)"> -->
                              <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                            </tr>
                            <tr class="cms_manual_edit" 
                              (click)="openManualCloneModal(currentData)" 
                              title="Clone">
                              <i class="fa fa-clone" aria-hidden="true"></i> 
                            </tr>
                            <tr class="cms_manual_delete" 
                              (click)="openDeleteModal(currentData.unique_uuid)" 
                              data-bs-toggle="modal" 
                              title="Delete" 
                              data-bs-target="#deleteModal">
                              <i class="fa fa-trash" aria-hidden="true"></i>
                            </tr>
                          </td>
                        </tr>
                        <tr *ngIf="manualRateLists.length === 0">
                          <td colspan="12">"{{manualFilterChooseFromShippingLine}}" data not available</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div *ngIf="selectedTab === 'BULK'">
          <!-- Content for Page 2 -->
          <div class="col-sm-12">
            <div class="row" style="background-color: rgba(245, 248, 248, 0.904);">
              <div class="cms_moo_wrapper">

                <div class="col-sm-3 my-3 mx-2 cms_rate_inside">
                  <select id="companySelect" class="form-select dropdown-box my-0" (change)="ListDatabyId($event)">
                    <option selected disabled>--Select Shipping Line--</option>
                    <option *ngFor="let data of templateCompanyList" [value]="data.id">{{data.name}}</option>
                  </select>
                </div>

                <div class="col-sm-4 my-3 mx-2">
                  <!-- <input type="search" [(ngModel)]="searchText" class="dropdown-box my-0" placeholder=" Search Here..."
                    style="width: 60%;"> -->

                  <!-- <Span style="float: right;"> -->
                    <div class='file file--upload btn find-rate-button'>
                      <label for='input-file' class="w-100 d-flex justify-content-center align-items-center" style="padding:2px">
                        <span>Upload File</span>&nbsp;
                        <i class="fa fa-cloud-upload" height="22px" width="22px" aria-hidden="true"></i>&nbsp;
                      </label>
                      <input id='input-file' type='file' (change)="onFileSelected($event)" [disabled]="!companyID"
                        accept={{dataShitForamat}} />
                    </div>


                  <!-- </Span> -->
                </div>
              </div>
              <div class="col-sm-12 my-3 px-2">
                <span class="spinnerMain" *ngIf="snipperDialoug">
                  <div class="icon">
                    <div class="bar" style="background-color: #3498db; margin-left: -60px;"></div>
                    <div class="bar" style="background-color: #e74c3c; margin-left: -20px;"></div>
                    <div class="bar" style="background-color: #f1c40f; margin-left: 20px;"></div>
                    <div class="bar" style="background-color: #2eB869; margin-left: 60px;"></div>
                  </div>
                </span>
                <span class="spinnerMain" *ngIf="templateFilterChooseFromShippingLine ===''">
                  <div class="shipping-line">
                    <h2 class="my-5" style="color: rgba(97, 99, 100, 0.767);">Please Select Shipping Line</h2>
                  </div>
                </span>


                <!-- Loading message -->
                <div class="col-sm-12 d-flex justify-content-center align-items-center" style="text-align: left;" *ngIf="isLoading">
                  <div class="d-flex gap-3 align-items-center">
                    <div class="loader"></div><span><small> Finding...</small></span>
                  </div>
                </div>
                <!-- CURRENT RATE -->
                <div
                  *ngIf="templateFilterChooseFromShippingLine !== '' && !isLoading">
                  <h5 class="mx-3 tableNameLabel">Effective Rate</h5>
                  <div class="cs-table-wrapper cs-hidden-scroll">
                    <table style="width:100%" class="table table-hover table-bordered">
                      <thead class="position-sticky top-0 start-0">
                        <tr class="table-primary text-white">
                          <th>Shipping line</th>
                          <th>Source</th>
                          <th>Destination</th>
                          <th>Transit Time</th>
                          <th>Freight Type</th>
                          <th>Rate</th>
                          <th>Effective Date</th>
                          <th>Expiration Date</th>
                        </tr>
                      </thead>
                      <tbody>
                        <!-- Display filtered data or "data not found" message -->
                        <tr *ngFor="let currentData of (currentcompanyListData | searchFilter: searchText)"
                          [ngStyle]="{'display': currentDate > currentData.expiration_date ? 'none' : ''}">
                          <td>{{currentData.company.name}}</td>
                          <td>{{currentData.source.name}}</td>
                          <td>{{currentData.destination.name}}</td>
                          <td>{{currentData.transit_time.time}}</td>
                          <td>{{currentData.freight_type.type}}</td>
                          <td>{{currentData.rate}}</td>
                          <td>{{currentData.effective_date}}</td>
                          <td [ngStyle]="{'color': currentDate > currentData.expiration_date ? 'red' : 'black'}">
                            {{currentData.expiration_date}}
                          </td>
                        </tr>
                        <!-- Display if no data is present -->
                        <tr *ngIf="currentcompanyListData.length === 0">
                          <td colspan="12">"{{templateFilterChooseFromShippingLine}}" data not available</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>

                <div
                  *ngIf="templateFilterChooseFromShippingLine !== '' && !isLoading && currentcompanyListData.length > 0">
                  <h5 class="mx-3 tableNameLabel">Expiration Rate</h5>
                  <div class="cs-table-wrapper cs-hidden-scroll">
                    <table style="width:100%" class="table table-hover table-bordered">
                      <thead class="position-sticky top-0 start-0">
                        <tr class="table-primary">
                          <th>Shipping line</th>
                          <th>Source</th>
                          <th>Destination</th>
                          <th>Transit Time</th>
                          <th>Freight Type</th>
                          <th>Rate</th>
                          <th>Effective Date</th>
                          <th>Expiration Date</th>
                        </tr>
                      </thead>
                      <tbody>
                        <!-- Display filtered data if available -->
                        <tr *ngFor="let currentData of (currentcompanyListData | searchFilter: searchText)"
                          [ngStyle]="{'display': currentDate <= currentData.expiration_date ? 'none' : ''}">
                          <td>{{currentData.company.name}}</td>
                          <td>{{currentData.source.name}}</td>
                          <td>{{currentData.destination.name}}</td>
                          <td>{{currentData.transit_time.time}}</td>
                          <td>{{currentData.freight_type.type}}</td>
                          <td>{{currentData.rate}}</td>
                          <td>{{currentData.effective_date}}</td>
                          <td [ngStyle]="{'color': currentDate > currentData.expiration_date ? 'red' : 'black'}">
                            {{currentData.expiration_date}}
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- CLONE MANUAL RATE MODAL -->
<app-clone-manual-rate [formData]="isCloneData" [isCloneVisible]="isCloneModalVisible"
  (visibilityChange)="handleCloneVisibilityChange($event)" (dataUpdated)="refreshData()" />

<!-- EDIT MANUAL RATES MODAL  (visibilityChange)="handleEditVisibilityChange($event)" -->
<app-edit-manual-rate [formData]="isEditData" [isEditVisible]="isEditModalVisible"
  (visibilityChange)="handleEditVisibilityChange($event)" (dataUpdated)="refreshData()" />

<!-- DELETE MODAL -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel"
  data-bs-whatever="@getbootstrap" aria-hidden="true" (dataUpdated)="refreshData()">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="deleteModalLabel">Delete Confirmation</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="p-2 m-0 cs_deleteModal">
        <p> Are you sure? you want to delete</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Keep it</button>
        <button type="button" (click)="deleteModalConfirmation()" class="btn btn-primary" data-bs-dismiss=modal>Yes,
          Sure</button>
      </div>
    </div>
  </div>
</div>